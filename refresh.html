<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <script>
        // ==UserScript==
        // @name         auto-refresh
        // @namespace    http://tampermonkey.net/
        // @version      0.1
        // @description  Fixed button, auto-refreshes websites in set delay
        // @author       Bartek
        // @match        https://fclm-portal.amazon.com/reports/functionRollup?reportFormat=HTML*
        // ==/UserScript==

        //settings
        const size = 50;
        const timeout = 120;



        //html

        //animated background
        const buttonBgcEl = document.createElement('div');
        buttonBgcEl.classList = 'bgc';
        document.body.appendChild(buttonBgcEl);

        //button
        const buttonBgc = document.querySelector('div.bgc')
        const btnEl = document.createElement('div')
        btnEl.textContent = timeout;
        btnEl.classList = 'refreshBtn';
        buttonBgc.appendChild(btnEl);

        //input
        const inputEl = document.createElement('input');
        inputEl.classList = 'time-input'
        buttonBgc.appendChild(inputEl);

        //style
        const style = document.createElement('style');
        style.innerHTML = `
            div.bgc{
                position: fixed;
                top: 50px;
                right: 50px;
                box-sizing: border-box;
                background-color: transparent;
                transform: translate(-50%, 50%);
                padding: 0;
                border: solid 1px black;
            }

            div.refreshBtn {
                position: relative;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background-color: rgb(177, 227, 177);
                color: rgb(59, 151, 59);
                font-family: arial;
                font-weight: 400;
                font-size: ${size * 0.5}px;
                line-height: ${size - size / 20}px;
                text-align: center;
                border: ${size / 20}px solid rgb(59, 151, 59);
                cursor: pointer;


        }
        div.bgc, div.refreshBtn {
            box-sizing: content-box;
            height: ${size}px;
            width: ${size}px;
            border-radius: 50%;
            opacity: 0.7;
            transition: .3s
        }

        div.refreshBtn.off {
            background-color: rgb(227, 177, 177);
            color: rgb(151, 59, 59);
            border-color: rgb(151, 59, 59);
        }
        // div.refreshBtn:hover{
        //     transform: scale(1.3);
        // }

        div.refreshBtn.active {
            top: 30%;
        }
        div.bgc.active {
            top: 0;
            right: 0;
            height: 100px;
            width: 100px;
            border-radius: 5px;
            background-color: #eee;
        }
        input.time-input{
            position: relative;
            display: block;
            left: 0;
            top: 0;
            transform: translate(-50%, -50%) scale(0);
            width: 30px;
            border-radius: 2px;
            transition-delay: .2s
            }
        input.time-input.active{
            transform: scale(1) translate(-50%, -50%);
            left: 50%;
            top: 20%;
        }
        `

        //script
        let refreshDelay = timeout;
        let buttonFlag = true;
        const btnRefresh = document.querySelector('div.refreshBtn')
        const timeInput = document.querySelector('input.time-input')


        let countdown = null;
        let refreshInterval = null;


        function startRefresh() {
            refreshDelay = timeout;
            btnRefresh.textContent = timeout;
            countdown = setInterval(() => {
                btnRefresh.textContent = --refreshDelay;
            }, 1000);
            refreshInterval = setTimeout(function () {
                location.reload();
            }, timeout * 1000);

        }

        function stopRefresh() {
            clearTimeout(refreshInterval);
            clearInterval(countdown);
            btnRefresh.textContent = 'R';
        }

        const refresh = function () {
            buttonFlag = !buttonFlag;
            btnEl.classList.toggle('off');

            if (buttonFlag) {
                startRefresh();
            } else {
                stopRefresh();
            }
        }

        startRefresh();

        const resizeHover = function () {
            buttonBgc.classList.add('active');
            btnRefresh.classList.add('active');
            timeInput.classList.add('active');

        }

        const resizeHoverOff = function () {
            buttonBgc.classList.remove('active');
            btnRefresh.classList.remove('active');
            timeInput.classList.remove('active');

        }
        btnEl.addEventListener('click', refresh);
        buttonBgc.addEventListener('mouseover', resizeHover)
        buttonBgc.addEventListener('mouseout', resizeHoverOff)
        const ref = document.querySelector('script');
        ref.parentNode.insertBefore(style, ref);
    </script>
</body>

</html>