<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <script>
        // ==UserScript==
        // @name         auto-refresh
        // @namespace    http://tampermonkey.net/
        // @version      0.1
        // @description  Fixed button, auto-refreshes websites in set delay
        // @author       Bartek
        // @match        https://fclm-portal.amazon.com/reports/functionRollup?reportFormat=HTML*
        // ==/UserScript==

        //settings
        const size = 50;
        const timeout = 120;



        //html

        //animated background
        const buttonBgcEl = document.createElement('div');
        buttonBgcEl.classList = 'bgc';
        document.body.appendChild(buttonBgcEl);

        //button
        const buttonBgc = document.querySelector('div.bgc')
        const btnEl = document.createElement('div')
        btnEl.textContent = timeout;
        btnEl.classList = 'refreshBtn';
        document.body.appendChild(btnEl);

        //input
        const inputEl = document.createElement('input');
        inputEl.classList = 'time-input'
        buttonBgc.appendChild(inputEl);

        //style
        const style = document.createElement('style');
        style.innerHTML = `
            div.bgc {
                position: fixed;
                top: 50px;
                right: 50px;
                box-sizing: border-box;
                background-color: transparent;
                transform: translate(-50%, 50%);
                padding: 0;
                border: ${size / 20}px solid rgb(150, 150, 150);
            }

            div.refreshBtn {
                position: fixed;
                top: 50px;
                right: 50px;
                transform: translate(-50%, 50%);
                background-color: rgb(177, 227, 177);
                color: rgb(59, 151, 59);
                font-family: arial;
                font-weight: 400;
                font-size: ${size * 0.5}px;
                line-height: ${size - size / 20}px;
                text-align: center;
                border: ${size / 20}px solid rgb(59, 151, 59);
                cursor: pointer;
            }
            div.bgc, div.refreshBtn {
                    box-sizing: content-box;
                    height: ${size}px;
                width: ${size}px;
                border-radius: 50%;
                opacity: 0.7;
                transition: .3s
            } 

            div.refreshBtn.off {
                background-color: rgb(227, 177, 177);
                color: rgb(151, 59, 59);
                border-color: rgb(151, 59, 59);
            }

            div.bgc.active {
                top: 20px;
                right: 0;
                height: 100px;
                width: 100px;
                border-radius: 5px;
                background-color: rgba( 230, 230, 230, 0.5)
            }
            input.time-input {
                position: relative;
                display: block;
                left: 50%;
                top: 80px;
                transform: translate(-50%, -300%) scale(0);
                width: 30px;
                border-radius: 2px;
                transition: .5s;
                opacity: 0;
            }
            input.time-input.active{
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
                left: 50%;
                bottom: 80px;
            }`

        //script
        let refreshDelay = timeout;
        let buttonFlag = true;
        const btnRefresh = document.querySelector('div.refreshBtn')
        const timeInput = document.querySelector('input.time-input')
        const buttonElements = [buttonBgc, btnRefresh, timeInput] //button elements array created for foreach function


        let countdown = null;
        let refreshInterval = null;


        function startRefresh() {
            refreshDelay = timeout;
            btnRefresh.textContent = timeout;
            countdown = setInterval(() => {
                btnRefresh.textContent = --refreshDelay;
            }, 1000);
            refreshInterval = setTimeout(function () {
                location.reload();
            }, timeout * 1000);

        }

        function stopRefresh() {
            clearTimeout(refreshInterval);
            clearInterval(countdown);
            btnRefresh.textContent = 'R';
        }

        const refresh = function () {
            buttonFlag = !buttonFlag;
            btnEl.classList.toggle('off');

            if (buttonFlag) {
                startRefresh();
            } else {
                stopRefresh();
            }
        }

        startRefresh();
        const resizeHover = function () {
            buttonElements.forEach(buttonElement => {
                element.classList.add('active');
            });
        }

        const resizeHoverOff = function () {
            buttonElements.forEach(buttonElement => {
                element.classList.remove('active');
            });

        }

        // const eventLiseners = function () {
        //     buttonElements.forEach(buttonElement => {
        //         element.addEventListener('mouseover', resizeHover)
        //         element.addEventListener('mouseout', resizeHoverOff)

        //     });
        }

        // eventLiseners();
        btnEl.addEventListener('click', refresh);

        btnEl.addEventListener('mouseover', resizeHover)
        btnEl.addEventListener('mouseout', resizeHoverOff)
        buttonBgc.addEventListener('mouseover', resizeHover)
        buttonBgc.addEventListener('mouseout', resizeHoverOff)


        //style inject
        const ref = document.querySelector('script');
        ref.parentNode.insertBefore(style, ref);
    </script>
</body>

</html>